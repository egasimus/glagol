(fn render [parent node]
  (let [widget (aget ../templates/widgets node.widget)]
    (if (not widget) (throw (Error (str "unknown widget " node.widget))))
    (let [rendered (widget node.options node.content)]
      (set! node.rendered rendered)
      (if parent (parent.append rendered))
      (if node.children (node.children.map (render.bind nil rendered)))
      rendered)))
