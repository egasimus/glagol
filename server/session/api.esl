(object
  "list" (lambda (cb)
    (if cb (./state (lambda (val) (cb (./serialize val)))))
    (return (./serialize (./state))))
  "add" (lambda (device-type args)
    (.done (/call (+ device-type "/create") args)
      (lambda (device)
        (var xtra (object))
        (= (get xtra (device.id)) device)
        (./state/set ((require "xtend") (./state) xtra)))
      (/lib/error (+ "error adding " device-type " to session")))))
