(lambda main (app)

  (var host "0.0.0.0")
  (var port 1620)
  (var http (require "glagol-http"))
  (var server-http (http.server host port (lambda () (return ./routes))))

  (var server-ws (new (. (require "ws") Server) (object "server" server-http)))
  (server-ws.on "connection" on-ws)
  (function on-ws (socket)
    (console.log "ws connection")
    (console.log (./api))
    ((require "q-connection") socket (./api))))
