(let [WebSocket (require :ws)
      Q-Connect (require :q-connection)

      address   "ws://localhost:1620"
      socket    (new WebSocket address)
      api       (Q-Connect socket)]

  { :address address
    :socket  socket
    :api     api

    :search
      (fn [query]
        (-> (api.invoke :search query)
          (.then (fn [results] (./events/emit :search-results results))))) })

