  (fn mainloop [screen widgets get-template get-data get-refresh-rate]
    (let [parse     (fn [] (./parse ((get-template) (get-data))))
          parsed    (parse)
          rendered  (./render widgets parsed)
          refresh   nil]

      (screen.append rendered)

      (set! refresh (fn refresh []
        (./change widgets parsed (parse))
        (screen.render)
        (set-timeout refresh (get-refresh-rate))))

      (refresh)))

      ;(screen.render))))
