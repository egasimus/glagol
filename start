#!./node_modules/etude-engine/bin/etude
(let [

  index
    0

  play-track
    (fn [t]
      (let [track (aget ./tracks t)]
        (if (aget track.seq index)
          (track.chain.play))))

  step
    (fn []
      (let [info (str index)]
        (log.as :step index)
        (.map (keys ./tracks) play-track)
        (set! index (if (< index 7) (+ index 1) 0))))

  ] (-> (./jack/init) (.progress (fn [msg] (log.as :jack-init msg))) (.done))

    (./transport/each (str (* 500 (/ 60 ./transport/tempo)) :m) step))
