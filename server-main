(let [

  w (require "etude-web")

  server
    (w.server { :port 2000 }
      (w.page2    "/"      client-main)
      (w.endpoint "/files" @server-library)
      (w.socket   "/jack"))

  sockets []

] (.on (aget server.state.sockets "/jack") "connection" (fn [socket]
    ((require "q-connection") socket { :api   @server-api
                                       :state @server-state })))

  server)
