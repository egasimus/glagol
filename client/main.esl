(lambda start-main-loop (app)

  ; establish connection with api
  (/connect)

  ; preprocess and insert css first to prevent fouc
  (/lib/vdom/insert-css ./style)

  ; start vdom main loop
  (var view (.view (require "glagol-web") /state /templates/app))
  (= document.body.innerHTML "")
  (document.body.append-child view.target)

  ; load data from server
  (/controller/emit "session.init")
  (/controller/emit "jack.init")
  (/controller/emit "controller.init")

  (return view))
