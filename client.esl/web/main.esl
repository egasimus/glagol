(lambda (app connection)

  ; pass connection to api
  (./api/connect connection)

  ; start vdom main loop
  (= document.body.innerHTML "")
  (var mainloop (./vdom/mainloop render (./state)))
  (document.body.append-child mainloop.target)
  (function render (state) (return (./templates/main state)))
  (./state (lambda (state) (mainloop.update state)))

  ; preprocess and insert css
  (./vdom/insert-css ./style)

  (return mainloop))
