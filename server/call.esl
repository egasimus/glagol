(lambda (path args)
  (return (/lib/q/Promise (lambda (win fail)
    (call1 (path.split "/") ./api)
    (function call1 (step api)
      (if (> 1 step.length)
        (fail "api: no path specified")
        (if (< 1 step.length)
          (return (call1 (step.slice 1) (get api (. step 0))))
          (if (=== "function" (typeof (get api step)))
            (win  (.apply (get api step) api args))
            (fail (+ "api: " path " is not an api method"))))))))))
