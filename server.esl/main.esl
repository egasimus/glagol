(lambda main (app)
  (console.log "starting with modules:" ((. (Object.keys ./api) join) " "))

  (var port 1620)
  (var server-http (./web/server port))

  (var server-ws (new (. (require "ws") Server) (object "server" server-http)))
  (server-ws.on "connection" on-ws)
  (function on-ws (socket)
    (console.log "ws connection")
    (console.log ./api)
    ((require "q-connection") socket ./api)))
