#!/usr/bin/env node

var chokidar = require('chokidar')
  , fs       = require('fs')
  , path     = require('path')
  , engine   = require('..');

var arg1 = process.argv[2];

if (!arg1) {
  var usage =
    [ "usage:"
    , "  etude <dir>"
    , "  etude <file>"
    , "  etude <dir> <file>" ];

  console.log(usage.join("\n"));
} else {

  arg1 = path.resolve(arg1);

  if (!fs.existsSync(arg1)) {
    console.log("\"" + entryPath + "\"", "doesn't seem to exist.");
    process.exit();
  }

  var stat = fs.statSync(arg1)
    , rootDir
    , entryPoint;

  if (stat.isFile()) {
    rootDir    = path.dirname(arg1);
    entryPoint = path.basename(arg1);

  } else if (stat.isDirectory()) {
    rootDir    = arg1;
    entryPoint = 'main';

  } else {
    console.log("\"" + entryPath + "\"",
      "doesn't seem to be a file nor a directory!?");
  }

  console.log("launching", entryPoint, "from", rootDir);

  var root = engine.tree.makeNotionDirectory(rootDir);
  engine.tree.descend(root, entryPoint).value;
}
