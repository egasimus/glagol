(lambda api-call (op path)
  (console.log "api-call" op path)
  (var args (Array.prototype.slice.call arguments 2))
  (return (call (path.split "/") (.invoke (./state/connection))))

  (function call (p q)
    (if (> 1 p.length)
      (throw (Error "api: say path"))
      (return (?: (< 1 p.length)
        (call (p.slice 1) (q.get (. p 0)))
        (.apply (get q op) q (p.concat args)))))))
